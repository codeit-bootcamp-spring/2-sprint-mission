<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>ìœ ì € ëª©ë¡</title>
</head>
<body>

<h1>ë“±ë¡ëœ ìœ ì € ëª©ë¡</h1>

<table border="1">
    <thead>
    <tr>
        <th>í”„ë¡œí•„ ì´ë¯¸ì§€</th>
        <th>ì•„ì´ë””</th>
        <th>ì´ë¦„</th>
        <th>ì´ë©”ì¼</th>
        <th>ê°€ì…ì¼</th>
        <th>ìˆ˜ì •ì¼</th>
        <th>ì‚­ì œ</th>
    </tr>
    </thead>
    <tbody id="userTableBody">
    <!-- JavaScriptê°€ ë°ì´í„°ë¥¼ ì‚½ì…í•  ì˜ˆì • -->
    </tbody>
</table>

<script>
    function loadUsers() {
        fetch('/api/users')
            .then(response => {
                if (!response.ok) {
                    throw new Error('ì„œë²„ ì‘ë‹µ ì˜¤ë¥˜');
                }
                return response.json();
            })
            .then(data => {
                const userTableBody = document.getElementById('userTableBody');
                userTableBody.innerHTML = ''; // ê¸°ì¡´ ë°ì´í„° ì´ˆê¸°í™”

                data.users.forEach(user => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>
                            <img src="/api/users/${user.id}/profile"
                                 onerror="this.onerror=null; this.src='/images/default-profile.png';"
                                 width="50" height="50">
                        </td>
                        <td>${user.id}</td>
                        <td>${user.name}</td>
                        <td>${user.email}</td>
                        <td>${new Date(user.createdAt).toLocaleString()}</td>
                        <td>${new Date(user.updatedAt).toLocaleString()}</td>
                        <td><button onclick="deleteUser('${user.id}')">ì‚­ì œ</button></td>
                    `;
                    userTableBody.appendChild(row);
                });
            })
            .catch(error => {
                console.error('ìœ ì € ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨:', error);
                alert('ìœ ì € ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            });
    }
    function deleteUser(userId) {
        if (!confirm("ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;

        fetch(`/api/users/${userId}`, {
            method: 'DELETE'
        })
            .then(response => {
                if (!response.ok) {
                    throw new Error("ì‚­ì œ ì‹¤íŒ¨");
                }
                alert("ì‚­ì œ ì„±ê³µ");
                loadUsers(); // ëª©ë¡ ë‹¤ì‹œ ë¶ˆëŸ¬ì˜¤ê¸°
            })
            .catch(error => {
                console.error("ìœ ì € ì‚­ì œ ì˜¤ë¥˜:", error);
                alert("ìœ ì € ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
            });
    }
    document.addEventListener('DOMContentLoaded', loadUsers);
</script>
<a href="/userIndex">ğŸ  ìœ ì € í˜ì´ì§€ë¡œ</a>
</body>
</html>
